workflows:
  android-workflow:
    name: 247votes
    environment:
      vars:
        KEYSTORE: Encrypted(Z0FBQUFBQmdwUjQxZGYwbzd5cENEWjAxZFBjbE55cU90cklWYS1uTXRlWWRfcXgzNXJGVWV2UnJDM3g0QVpjSUNhMGFpQ1hLbVJaa0UxWFAzYVgtOW85NjcyRXczeTZENEZEdlExeWJ0Tm1CMWZZczFkOWdKNGVLbUxnWTViQWJJck5oNG5DM29NWEphU1g0QkdsOUNDWGF3VExsTGRPZWxVVDh5dVhRSlBFdVQ4MHlBSjFaQndrbXdZRHlKUjk2ZVpYdmRyZWxoSmd2Uzl3VmkxdHJhUHE0TnQzdFdRMHRqSnBnVDFMZS1FVDdnLXhUR1dBaVJvQVNxTGlpb2RrVmdnbm90N3huc0x3R2trVm1NS0habVBuOGkxVUxaeDZZZkpGdWFVUFhGV3UtTVBqc1lERjJSUXFvWWN4TjRmTWJZcG42WFhTYUR1b0xHLWI2Z1otZzktQ1RhVlhTcXVFa2xFTC1XTE10eDNUalNwWE9DazQ2OGV6aExpaGpZcndudWhhS2Y4QXptTnJOQ19TTnQwa3BTbUJiSHlOd05xV3hnWmllUFV3ZlhjSThLSWxkWkJ2b3pNNkt2Yk4yTENmbWhveUVrSEFMUHNZWUtwWmF6cklvWkNUTURfSXNMN0FDX3FpRlAzd3UweElnSlExczREbC1BdWpla0dNMWVTOGpCQ2RTWUVzVlNicFY5TFVGRVRQWktlYnpqS2tIR09KTHBTa1ZWZDdUYVYxM2dDTkJoeC0tNThQcDhTOWYwMEM0cWk5V194R1VvUDFBcGtFU2xEczlwRjdGekNJZFVPVFZLc1NxREVJRURrdWVSbDEzOVN4OHBrRDJtczYwM2JBd0hHdVFsMUliVTJTQTZpaXBmSmx0RThVY0hNOGQ5OHJaaXhPRk1GMzJzQVgtTzJNZVU2WmlJQ0JOSFQ0Uy1KdGpRcEp6VFdRam40X2NISV94YUJqTnc3RzRiYTc0ekRhc05iR3BLX0s4UFJiRWxqZzQ4TllGOG40ajNWY0NVUVNHX1RyRjhiWHY3RzBTdVJJRWJ0ZkxsdEVObXpIdHU3eXdYTXU1X25uel9qcUF5R0NWSDFjeGVxOENyV0hDdkRkVFBxcmlFaVNHUzl2b0tpMFJzbHBoUGEyVFA4eDFST0FtVVJrejZTSWtMOVpDVExBS1QtY0p5QU5YYk43cWVuZlQ2MUhZU2U1aG03Y3Zvc3hKcHM5OGlpMmpGRkVRV2JhWnRYWFpFTEpGNXV4WHcyTmRjeXo0TjJybm10QVJzZWpMcGFmVU8tRjNYdkttbnhPbW9uWGhCTjV2NWRrQUxyeHpsTEl4Q0NXT2w0TklOVEh4WGthVElSTGFKU243Y0haRVRkc3VEVzFrSWxsSmFvdWYxZ3pBekZNUDdXRlR4Wng3d042SW9MZF8zWmUyX1NVZ0NkSTJXZnppLXMzSk1wbUt1UDg1UmhEd1hnWVJCejZNZmxySGlTcnowWEVMYUwtVktPaGJiVmtPYmRsS1BlUklHc0h5dW01RU9NeHFIOWoxNWtQM3VrVDR0aWhzSXFFUjJxamFjNVVINFhmN1QwT2QwYnlKWDl2OFd2YWZYMVhXWjFOVGtFTmpsWTI5bWtUOE55S192aTBLTnRCdGRMZEFFR1BHZ3k3LXI0VEJodnhDSlNCOGdadDcxdWFwMEU5RnREakZXc3R0NXZZNHVKRWI1V1BZek9aMTkyZ2dfdVBGZ0ZlendIZDF6a2tMTk9fUkVaRnp5SmdsNl8walZpRVl6c1RuMV9pMlBoSVktSHpJVzhlQ21ZNzYxeWtuMk5pMkVGQ3ZKdGRLUHItZnlzZDFDSWZNamZJZXRvWGZKWVlCNWhOZ1Rkc042enV2ZkJqNzlqcmktTk1FZ3loalNUZXVGMHp4NENlNU85SnJTNkhtRUVaN0hMaXJqZU5CS3I0SmtNVUZJZ1BKTGFUMjVsQjl2MDNFOXpmVG56aFQwUzBndHM3SEVJTHRieWc0RTNSYlZRLVpGczFiY1R0WXFZNU5BMXk2dFEzMVVGS1Z1VmNaeW1QeXFEbDZJR0tkODBONXNTMlZXUmpFMlZLU0N2LXpjNno2bjBxRkZHUG82NEM5VjlPNjJFektwNS1XSEdRQVI2SHl1bk05RUtQakJsSDV3ZTN3ZUkyYjFTR0p1dFRvZjZSSExEaHhOVGt3TFUtRXJyckJyNmhFQ0JkXzI0bkczaVc5ejN3YnFULUVPRHY0SjBwMU5jWEhQTnBHUVJ6Q1BYYW5GODdIU0tBLUVIV2ZpSFpGOTFSeWRORm5XRTYxMWJnM1ZKM3U4RmV6MTB3R253MWUyMU9jVTRQMlJxdlBxWjZNMF9pREd4bTU0elhMVWdGWkw5RGZ0cUd4UGRwUXNtc3poVzhkcHFfVUJyN3RYSk1zbzdYWlprTkdjOUVvQUFMQmplbG9pS19kczMwZzR4ZGV6eUw3MjUxZklrTHczN3g0dnpidkdZbUVBRGhXSWxLdU9lMDhiQlMyZUxHUXUxRXNBdE5xMTgzVGQ3RXZrd0taZU9GdXhlUEJnYW05Ynl6elBFUkwzVmh1MUtzdUN2RzZVR1g5X1lReFRSUUptaXJwb25xMFdrVDBpYklXQ1ptT3U5S09zS3hXdldKdUlyZzVwak4wTlVSRjJmOE9aODFXWTI4NElIUlBGb1NjeE4tRnp4NFhobnR1cGJ1ZW5WUEZ5NVdFZDdhN2dhc2tFWmZuZDVPbGFrYkhaY3dQdFdfZV9QaXB3VHo1MWVacmVqQVNnWW5IaThMa2VTUTRTVkxUNzZGN2VJckVwbWJRTFBnUVVselFydjZldUJVbEM5UHNmdVVzczNTYzhOeVlidTZueTV5M2RXb1V4am91eXFMeVNScU9xVjhHQURyRE1saVdQZ2toNG45WVFQQ05vR0lYWlh3dTZiR0hIdGxsLWNUQ285ZzR0ckUySklZUFlDSHBlZWJPQ3Bqb0N3dWlzSEhiT25TczhKeExTZ0VXdE5BSUx5RFE5amJBa0VGRHN5c1NSQzRXM2VhVWtHMmxhZkpRYU55UXJUWm9sYXJOY3hEWEktSTcxTnIxNGc5eDNZbzNiZ05ZTjBoVEt2M0FLMmdSbmlHdTNZSVd6QkxHVVduTl93RFlfRUZEUlV6T0FOel9PUkFLWk9YWlhnVWJBa3J3VmV5M2ZNRWNKRGJ2SjNfbEFBempUejBIYWR5WUdJNmVkSlliX2o1MGJldUZ5RTVFTy0yV1ZWZGgzVkFFTFZKQjR3SDNYaFFzaG9QZzNDQlNmM2U0VEtZSkwwSVRTWjJ6bmM2ZVZXUmZxSmdadXhqa0lHMnVUTV9mLWVvYWViTVVyX3FaWXk2cU9RUGh3YkZVS0t2Xzh5WUN5VG9Ba19oN01aY01VamZiQkg1aXc3dUsyQTRBY0lxWDdvQmFpbVFzSDZ2SDVxMGRUZE02RmV4ZUxTcFJCa1JJNFlhcWV0SnVmQjQxTjAyZE1FN2FYV0hYUFhpMUhzTndpa0IwaTZ5ZkpGSWtrQkh4b0IxVmJiUkZEVUxmYTR0TWJuVXd2VFNlRjlTTFduanpPM2FQVmtwWFAwTXRTZHlhRk5nZ0xNZFl5VUFGR3FzbjZiZDJIdXVUemZyRGtwN29kbU9yVjkzZmZ4NWVyZWYzb1RmRVh0MmVKbER6ZUlZc3pBZEFBQmJwTkhsV1dYcVRoU20xNGhmMlZzanM5NEY1OERoOU83aGt3OENxNndwajZTb0hOd0hRM2p2VWhUUVpra1kxSkNHQS1wTUp5d3J4YnlpN1FMd2djOElkcGRvQjJTWnZwc1RaQ0NucEVjdmZ3X3hYODd1NGxubFBJLVdoVnd1ZGpIR3lKeFNiT29sUThiaEtoMkRFajlQZHFXNmpSM05LcmhFaGRLd19jenF4WnlsOHRjcngwYVBYd0hjYWJVM1dIMGdaQ2RGRU14YXQtWWtQSmRablh6LXo2WnQtenZpT18wSmpqcC1aYnU5YUVQelVEQkVIbElSWG1pRmNNVGozY2JNWEI1RnBPZHBuNy1EeGprWmlzeUJjSldZS21USm1rS2lPWjNqMlZSV0kxbTBWT2dtYlN3cU1KdFhHRW5TMXFMYlk3NFVMNV91UzlDY2E3MFZiNXZVaW5fV05naUNqWU5BMkNKVFZhQjRJMVVvYjVHNHVNZnQ5ZjcxSlNyVFR0MUU4VUJlUS1Mc2c4bTFLdVI3a3BQRFZ2ZDduMEhUOGlqNmxnd1RWal9qX19abEZmWXZ3eW9zRE9jajdVQkdxMUJIMXlVXy1XWEVjellOMENoaUpGamg5bHNwRzYtMFZ3SWJ6M2hmN3ZZbzRKSEhSUDJOZS1NeXVVdXJqSnlOd3JRcThOeUNzZGQ2eWdBb2dsU0ZVVFBHbUR5M1RtOHdLU05ZNDRLREpqalZMTDVCZFgwT2kzRE9RamRaT1RVRTUzdDVNN1FNV0tKOWxiaXRXekh4b1FaS1lrR29TYjF0TWhwOGFVSkRqUDhCTGFMb0FPaWRVTXRKSlBJbFdwQUF1YXZSejBmcnIxMWc5WnpMWUNJY2F1SnhZc1hTaUhpcHJOSVEzdGVBTG1OUnVWaWdwM0ZndUppdFhFYkRxTlVMT3dxbkxqSjRRSklKZzdoZW9OUXhjMTBtWFZsNWhSMFJrdlZWR1JzNk1VOW1PdWlqVXN2X3JabEZMMkhla00zcjlyNS0wWlBLQThTZms2YS1DcmJ6OC1hTWRueXI0LTMxdm5IeXZsdnJWWTV4Uk5PZHNjNzlKQXVtYW9kdzd1ZEZnSUd6cndEdHFkNGwwb2hhS3NGNldmUzhIR3VnRWU2bUFxWGhsWkllQXNBRHBSbjZGM0FFNUNmN1NJTG44QlY4dDJaQzZidGZ6T3ZKbVVKcm5nVmQwM1hmM2k3SU9fRUNJSzZwTWxmOFUxMXBOVDJodkp6T3dtV3pLeWh0OXNXLTdVMTZibms0dF94ZUZ5N1BibEZRZFRMbF9WV0ZzYm1OM1dGQ3pJUkJVME15WnE4OFRmNXlPMHY5Z2pIWm5BOXRTVUpRVjZiWndGV0lvUUJoeWNlM1pBWkQtSmVtQ2lvazZPRThfTU54OHFWZERYTVNMZ211eHJhWnFTVU0tLWpZS0czLUJuRE15bmtzS0JIdXBrYmJiOTBTT19rS2ZaaHM3N1M0eEN3djhyOWFYbHNpMzc2WXp1alI5dzl1eUc0dnlmMWp1ZTBCUGVlU1dFR015QkJVdHdaRXN5M3NsWWFpNXRndkp1U0FEdlV2cXFfdG5mUjVaNFQtR2cwMzZRV1JPTDF2c01PWHZ1ZENwT2tVX1FKdUoxSy1xdnAtR0RrNnFjbzJzVXdMcW1oMHpWdzhlb2RYNkRjOUtOTHpCTFQtUUNrM2JqTnlmeW9UaGp5aXpyTzRZbUVYc3NnT3RRWmVLb1d5aE5jaWxnREVlWnNaNmpyYzlyYU5velEwUA==) # <-- Put your encrypted keystore file here
        KEYSTORE_PATH: '/tmp/247votes.keystore'
        KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdwUjI5NXFvSmVDalVBMkVhX0hkdHA5NTNBa2M3ZkFOeWwxQTBTeUFRUGJvUUhSTmx3Nks1R3NyNTA4bHhOU0liWTlTRnhUSlI0RW44MGM0N1lBeFlPMlVqUHc9PQ==) # <-- Put your encrypted keystore password here
        KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmdwUjI5NXFvSmVDalVBMkVhX0hkdHA5NTNBa2M3ZkFOeWwxQTBTeUFRUGJvUUhSTmx3Nks1R3NyNTA4bHhOU0liWTlTRnhUSlI0RW44MGM0N1lBeFlPMlVqUHc9PQ==) # <-- Put your encrypted keystore alias password here
        KEY_ALIAS: Encrypted(Z0FBQUFBQmdwUjI5NXFvSmVDalVBMkVhX0hkdHA5NTNBa2M3ZkFOeWwxQTBTeUFRUGJvUUhSTmx3Nks1R3NyNTA4bHhOU0liWTlTRnhUSlI0RW44MGM0N1lBeFlPMlVqUHc9PQ==) # <-- Put your encrypted alias password here
      xcode: 12.4
      node: 12
      npm: 6
    cache:
      cache_paths:
        - $FCI_BUILD_DIR/node_modules
    scripts:
      - name: Install dependencies
        script: |
          npm install
          npm ci
          cvm install 9.0.0
          cvm use 9.0.0                  
      - name: Add Android platform
        script: |
          set -x
          cordova platform remove android --nosave
          cordova platform add android --confirm --no-interactive --noresources          
      - name: Build Android
        script: |
          set -x
          set -e
          cordova build android --release --no-interactive --prod --device
          echo $KEYSTORE | base64 --decode > $KEYSTORE_PATH
          UNSIGNED_APK_PATH=$(find platforms/android/app/build/outputs -name "*.apk" | head -1)
          jarsigner -sigalg SHA1withRSA -digestalg SHA1 -keystore "${KEYSTORE_PATH}" -storepass "${KEYSTORE_PASSWORD}" -keypass "${KEY_ALIAS_PASSWORD}" "${UNSIGNED_APK_PATH}" "${KEY_ALIAS}"
          mv $UNSIGNED_APK_PATH $(echo $UNSIGNED_APK_PATH | sed 's/-unsigned//')          
    artifacts:
      - platforms/android/app/build/outputs/**/*.apk
      - platforms/android/app/build/outputs/**/mapping.txt
    publishing:
      # See the following link for details about email publishing - https://docs.codemagic.io/publishing-yaml/distribution/#email
      email:
        recipients:
          - support@callysconcept.com
          - callysconcept@gmail.com
        notify:
          success: true     # To receive a notification when a build succeeds
          failure: false    # To not receive a notification when a build fails
      slack:
        # See the following link about how to connect your Slack account - https://docs.codemagic.io/publishing-yaml/distribution/#slack
        channel: '#channel-name'
        notify_on_build_start: true   # To receive a notification when a build starts
        notify:
          success: true               # To receive a notification when a build succeeds
          failure: false              # To not receive a notification when a build fails
     

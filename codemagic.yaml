workflows:
  android-workflow:
    name: 247votes
    environment:
      vars:
        KEYSTORE: Encrypted(Z0FBQUFBQmdwVUwtUHhYLXFLOHdiZGx3VkRoVnJScE15S1FobjFCY3hCalBzSjdiaGgybHlnU1lmRXY5UE1tckVHeERVclc2LWNoRnpLMHQ5MW9hdHUtS19mN2U2QkFuYzVOMEY2Szk3a0QzdldRRC1RRlg2OVY0OHE3Wl95Y3gwejl6NktHQ053N1N4N0ZuS2dYRENBZThoWG5jTXV5TDBBWFYxUVZzODE1NW9acDhKVVdQQ3EwMnpoWWc4OFpYRDVmaGszR0xic0R6RG9IaGs1TWFEMVI0a0trUzNmZXpKTU9yM2NJX190bGtMZ2J5R3J1NGJLMk5vWWdBb0ozYkU3M3l0cG8tLXVFczM0S2xHWmNhWEw2TVBEd0h4ZzRpajZiYm1iT3FNZ1ZicFd1YklHRk90UFBpNmlPREw3anJXUjR5VnpDc0lWYl9vanl1eU05MDJqaDdhNzUxRVdnd0VycG9KdW1taVREckh3bERaMFRpSC1ka01fVVlQdV96dGlLeUY5YUxBSGI2SEFGTG45b2tpSVlPWklrUW00b0pYcDVldDdPZ3lEUU0yS2FKdmI2clJydkJSLW56OFlBNmRGTWtmNDJQV3IwU3MtRFE0U01CdW83Tng1X0EzbG92NkpQaDhrSVVwT2x5Z1Y0V0ZFYUhUWEdnYzlmdHJMR05wM2JjSlRBWE9hZ281X0ozNXU0VER6NjF0ZkZabUc5SjByNlh4MjR1dUctalNyRDNIbVBXeEItLXFzV3Nrd1lmZlF3UlcwYkMtMUFsZ0U1REJmV0g0eldENy02eHpCUUYwNjFMMTNqXzh6MlB1QUV6MjQ4QnZUTnZXOVk5ZWVPSHVZTmRjWHIydWtaT0RaTUZyQU5FdUp6XzVISy1NeGNYeDZxak5BZm90MWFzWVdnRmdaa2JLTS11SE4yWk1KZFJ5MEdwVnV2N3FCZXh1SjU1NG4zYjdNdG4teDlqMnZTVlBRMGJQX0JjMzRUZlMzMnplVWxMZzI2Mko1SGx3VzFrQmdkZzNkSGEwVFFsVEtKMnNCUUJZZ29RU2NQb1FIOWR1WEIwOWw2bTg5bHhuMDAyT1lhUkxNOG84eW9IdTI2VlRxV3dPMFJzV2RpWFFxb0lxaUtRanNWZ1JIRjAwUG13V2FkRGo3T2xVUjlCSFdZeTVfY09PSzlGY2xVcWJsbC1DOV9GNXRRQzEyMmI3c0lheVJDS0E1YmVDNENUNnlOd192U29INTB3Yk00X3JSNHliY1RLYTBYVXRRcUdIUkxpWjVBclFoT0dWSUZ2MFY1aExsdWdjSTcxbFZFMTFxUFdBNWVJeEEtbkFGNzJkc1JubHdRc0tQajV1TGx5U20yUGFQLUM0ald1eUFySkJYM1dIUVd6VWtwdU01N3FhaVFPaWhQUG80cUpIWW5rWDlna3NmNVAwZ2ZlaTZ2SUN5LUJkUEU3elJHVWZ2d2xiYUlIVnU1eGFwbkRpaGFqNlpWS2w0R3J3TzdtOV96eTl3NmRsSWYxYUg3Z21LR2lVbFZvUUp1Uk9qSWduaFhmRDlBMldleDdYdnBSYXRhTjVScS0wLW42dkI5UFpfcDVkcHYwZkV6WEducjJseE5BX1ctdmRiMmpnalJHVmY1TGREM05rY3ZxbHZoWVN5bi1wcmJMcHJtcDFHQWYzSHdnMVN4WWQtVnpOaXFqbEl3V1lsRlRGQXMzNFhweUJHUkZlRFJ1ZmJiMk5zWXhJRW5ZOWk1SzdnUWJkTWFhcjZqOThqNVhNZExhSUw1RFQzVEhBbFRrbXlfczJrd3N3ZXJmT1ZPTXVJRUZqZXptek9MamxySlRfUzNjcFdDZkpTOW9JM2pkbXJxcmRMWXlUSEM0Q2NiMGxEdzBDaUdXYVJETnVLeUZSVURHZTR4Z2tJQTAtcUltVHBzS1JwaGdMZGdEbWgxUWFOOC0xTHZMS20xallLU0pNVWRlelJKd281dnpLVlphMk45QzNXYzdLbWhjSHA3RXJkcTdrN09wWXR2LVRXMEdyU3dLUXI4Z1hzcWt1b3lUR2tvc1lGNWlMdDFXNkxUTnFPcnp6Rjh1elBMUTFIa1JybVFidVpTQm95Y0VQbEFSc3BRVXNVeDQwRGJBaWJPVHZIREJWVy13eS1paWNCMFpSbXo5ejFXWi1ZcmptS0l5RXRYbUc1TGpqOEN2Qjh0ZUcwVDN2WHJyRmJlWWhValdXaU9DX3Q1OXNQWUhQV0o0b3k1Q25vOThoVWVScGl2eTFHVEtpMzdBOUt6YTg1ei13NkNyWU1vM2swWWxqYnI2QWQxS3haemJDbXRzTVhtSzRmN0hrY2hfVlJMZ2oyLVBMWkxhX1pzRXp2UkZ4T2hPZGJyV2JlUVBhSnU1NDlNMGFOZjhWbVVTd285NkhMcExOWkNCMjFMdjJYZ2JsWl9KZjRUQnlVNVI2QU1odzBvakY2c2JKZXJKMFZGOW5PMGhwM2Ezbkt6ci1NUlc2MUFTb09RcUkzellzMGE0dTRuWEJtZUpPM0NRbjlLVkY1ZjZJY3ZZTHhpeE5rQVY0STRwN0oxVnkyYWoySGQ3V2M0LTVvMVlTRmc5UjZ0cnJwWWZpZXl3WTdtOFNla3ZsWHZ0MlhrQnJ2VmZQTVNSN3g5dzhmVWtPZjVsVExOZXp5WkJEQXB1X085YjBJODRydlExcGlvNFhGa2xsNEVmQ1gybUIzRGtpX0kyQjFxdDZ2UTlOa29zOHJPbllkXzVMUUJIWEVhdGtOT2hQcUJoZlFNRkl3Y3M5bjNDVFdfRVkyblRfSmgxaG9PUEI0OEJHcUpDdS01akpNMXJuWnNGWmt3YkdRTld0bVBEWUNkMkltdnhUTDhxbTFnWjFYTlpuZl9rWmItZkZ6bHRMWXRwenItOTNBTktCSnFFVFRrdjNFTDB2ODNJRml6eEV4UDVhM2VVc3J6WEVTbDFKWDZrYU5qS1hLejZUMjFjckZLWmpWYkJVM25fR2RzQTA0Z1hyUFlGOXprWXIzbnFHaVpvc3FSMjRvZ3BINkY0Ulp1SjZyMkZINTdLaWtsNjRYek4xaXFfZWhnampYX1NYRUtzdzROa2ZvV2dhQ0hFZXpWZVdyejlZc0lrcE1acDZfUTRBRkZ4amxiVzFlc3JZVHR4TkNCZWdsUk5ZclRTUjl1SDB1SkRmSlBDcjJrcXc5RVl4ekFCTFFqNGVpVEZLeGxaS1JoR3luNE1kY2hhSlZjejl1ajRoMUVEZmc3WkZOZXE5WmY0a19IUjhUZ2hPamRBazFsVlh2TjhGa0Uzblh6TG5tUC0xdGlfeHFPR2hNRTV5V1FyY01SVkNGZE1JcURhU1pNenR5NGlWSWJ6Q1QyX0hWTFQyYlMwaGxVdFgyZkt5ak5vdVpjRHVNOGJ4TlpFZGt2bHhrdzRxUEVqUUlubEVjd3B5WjBiM1BUVXhIc0RiZHBadi1HNzB0bVVxaU1UU2MwN3g5M1hLZzVlTTduZEdmLVR5Yzh1NDFmaTFyZ2JwNWc1ZzgxaXhNZ2dlaUMyUGhoNm9ONXZNczQ1c1cya3AwbUQ0T2RmRnVENXUzSXJlOHZyUm5wU1Y0UnJEdHNLdXlVaDRwd0VZYWZET1lsS0UybWJVT0hnRTFvYnN6RXdTc0tmdDZGSDFsUi1pMzg2UEoyVWhWc0VFSkl1c3FZcUhibTJoRWZPZHhyU3B1QkthSzRwd0laOFRnaGZ5dlA1NWJIQjR3UmZ6WWZmOVhDdlBqVlY0bWlrS3o2RElXMEZIcEo1NEowS2ZmbHhnSkMtazdtSkxRWUNfSi1VbkkxaWRpU3B6QzBKUl9qMm9JakFJQ1VRcFcwR21ZSXRjRjJGd29fdjQyYTktUjV1RWNXcXNuM21qTktBVUlJdVR5YkRTdFVRbERuNkVVemJSd2xNb3FqdVRKcnJEVk85eUVDZTZoaWliOUVOM1RRS1RwZ0lfbEVRU1dFX1gxOXA0YmpmaDNnS0l1WEo1cG1YcmI0dnFpMjdkbjFxd1k1UUNodklhS2hmUF93bmEzbXUzLUpMZ2FaQWdoNExQbzhnYVdNc0tzeXFXS3puVC1lWjhKT1hrOWQzb1RpREx5b1hSUlNtbFBicDZLUE5oR2dTU1BVOUc4ZWlyeGtfS0NTdElILUVxb0xKYzZmckduNkZZSnVjTXdWR1h6eW5UaEF3SU1raDBwX1ZCaExUOEF4RHNYU0piQmFSMGtfSEZCbTBROExxM3BWblZQbDBTWWtGOEZ2X2JaVFFnWkVTUUxxSUc1andheVNmMVJXM2VTRHM1aWVIZzJWTzl4S2RfS2w1MTNKYVlFaG1BSHpDM0g1MDA4b183YkVoZUdtTk1rSlduUC1JZFczT1VGZF9qYzFBTHRGMEM2MlpUQnB5dkl6TGp3VVVCdVctVGhkcU5KVGJ0czNmT3l2NzFwVzBjaGg4aTBCem1raDViUkNsb0phVTh3NDJKaFV3dXZrUDB4MHN1c0s1MUcwSXpnenVLUU9jQTFSU1pKQkxLYWFCLW54ZEUyU2Ewd3BpeFV2U1pqck5fVlcweDRDWldKb3o5OVpZM0hsc0VlZkN0UUpONEpZYnJnNjd1OWZYMmdUWU8ya2sxb3dpQkprVUc3R3lzUFF0THQ3WmxuWU5qX0ltcVF2anpQa2stbXM1MzlGMmRpa1NtN2toeW5PS3NHdkdHdGxxZEtyVGgwaENzU0djYVc2dGU5bXAyOHNKb0VvdXZZSFBjLWRrTzlmRXZVNWtkNExCZW5IejNyNEM1ZURVNzVoclA2Y1oxSDYtYjk5RE40MWZXWGVfbnVaaGtKc200aWZ4MzJDbDRuc0lRSEZPRXNfb1F6akVWelA3ZTVNWnB5Rm1QYUpKdHB5b3gycHVPU2dLclR6aC0zdV91eEJ4WHYwUm9fcWJOS3FMRklPS0VVMEh0SDlFcWhCd1J2QVlmY1QxSUxTdnFlMUJDb3U2bXFIR29MblBKSVU4N044czVaTW1FbU9EZy1CZFZNSEU0emVBWHVSSk8wclo0VVJDTDZKZFcydFpEU1Z2SWRfQWV6T2d2N2RvN0w2ODhmX01xajZnZXlLNDBMWUg1cHRkSXU1bng4Ni02TXlscmlVaFIzQ25NdnIyajlMQk9OZ043OHV4UEp5UWJuX0FZbTJ2M29OUnktc1lnTUZVeXV3eFItTThEcVUxN3phb2tqdDNTZnJqdTNxV0tGZ1pWYjZfaHFscDhTV0JrY3hQMlN4NDBCVFFHNWlCa2NqdnhmVDF4aXJwNVZMbEo1UjZ4cWdLbUs1TmlWUFlGMHEzRFlkN1oxTTdxdmxJUnBGRHBYN1FvYTFOaFRncmFvd0VWNHJIcUFiRU9La0ZXcHZhWm9URy11SWhJbWtrQnBkQ1BYa1dtNUF1RTJoX3FjeUh4TGVtdDNSdXlMUjNzWDRaVWhDRUdZdFNaOUgxcTRxRU8wRjFJcFc5RHRNdQ==) # <-- Put your encrypted keystore file here
        KEYSTORE_PATH: '/tmp/247votes.keystore'
        KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmdwVUxBQWxQaGhrVDBFRUVJb0pxY09CcXlITmJqRENxcURYSGlfaTFHQkFkbmR4bnlxNERaZkN2VkdWNlRUY1NHV1p4Y3UyS0RidTg3ajZ1TUROMzR5LVlDTGc9PQ==) # <-- Put your encrypted keystore password here
        KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmdwVUxBQWxQaGhrVDBFRUVJb0pxY09CcXlITmJqRENxcURYSGlfaTFHQkFkbmR4bnlxNERaZkN2VkdWNlRUY1NHV1p4Y3UyS0RidTg3ajZ1TUROMzR5LVlDTGc9PQ==) # <-- Put your encrypted keystore alias password here
        KEY_ALIAS: Encrypted(Z0FBQUFBQmdwVUxBQWxQaGhrVDBFRUVJb0pxY09CcXlITmJqRENxcURYSGlfaTFHQkFkbmR4bnlxNERaZkN2VkdWNlRUY1NHV1p4Y3UyS0RidTg3ajZ1TUROMzR5LVlDTGc9PQ==) # <-- Put your encrypted alias password here
      xcode: 12.4
      node: 12
      npm: 6
    cache:
      cache_paths:
        - $FCI_BUILD_DIR/node_modules
    scripts:
      - name: Install dependencies
        script: |
          npm install
          npm ci
          cvm install 9.0.0
          cvm use 9.0.0                  
      - name: Add Android platform
        script: |
          set -x
          cordova platform remove android --nosave
          cordova platform add android --confirm --no-interactive --noresources          
      - name: Build Android
        script: |
          set -x
          set -e
          cordova build android --release --no-interactive --prod --device
          echo $KEYSTORE | base64 --decode > $KEYSTORE_PATH
          UNSIGNED_APK_PATH=$(find platforms/android/app/build/outputs -name "*.apk" | head -1)
          jarsigner -sigalg SHA1withRSA -digestalg SHA1 -keystore "${KEYSTORE_PATH}" -storepass "${KEYSTORE_PASSWORD}" -keypass "${KEY_ALIAS_PASSWORD}" "${UNSIGNED_APK_PATH}" "${KEY_ALIAS}"
          mv $UNSIGNED_APK_PATH $(echo $UNSIGNED_APK_PATH | sed 's/-unsigned//')          
    artifacts:
      - platforms/android/app/build/outputs/**/*.apk
      - platforms/android/app/build/outputs/**/mapping.txt
    publishing:
      # See the following link for details about email publishing - https://docs.codemagic.io/publishing-yaml/distribution/#email
      email:
        recipients:
          - support@callysconcept.com
          - callysconcept@gmail.com
        notify:
          success: true     # To receive a notification when a build succeeds
          failure: false    # To not receive a notification when a build fails
      slack:
        # See the following link about how to connect your Slack account - https://docs.codemagic.io/publishing-yaml/distribution/#slack
        channel: '#channel-name'
        notify_on_build_start: true   # To receive a notification when a build starts
        notify:
          success: true               # To receive a notification when a build succeeds
          failure: false              # To not receive a notification when a build fails
     
